\section{Trustworthy computing}
\label{sec:trustworthy}

\subsection{Smart contracts}

Smart contracts is the concept of using computer code to enforce and secure contract law and specify other formal relationships and expectations in  society~\cite{szabo_formalizing_1997}. Digital signatures make it possible to authenticate an owner of digital assets. A system with an authentication mechanism and a record of digital assets that can be transferred between owners can serve as a smart contract platform. A smart contract is similar to any computer program in that it will execute some code, but it is different in that the execution and the result of it represent some legal concept, such as the right to vote, the ownership of something, an identity, or a more complex construct. A smart contract is not necessarily legal in that its code has legal status is any jurisdiction. It is rather that the smart contracts exist in an environment where they can enforce something, or the meaning of their computation represents something enforceable. In such a computer environment, legal entities can be authenticated with digital signatures, and agreements, expectations, and conditions can be written in code.

A simple example is a trust fund constructed in Bitcoin smart contracts. A grantor wants to make a trust fund for a beneficiary. The grantor programs a series of Bitcoin transactions $\{tx_0, tx_i, ..., tx_n\}$ so that each is spendable on the conditions that a) the transaction is digitally signed by the beneficiary, and b) $i$ years have passed since the trust fund was created. If the smart contract platform support sufficiently expressive scripts, it is easy to imagine more complicated constructs of a smart contract. The trust fund contract could be extended with almost arbitrary conditions, such as allowing spending if a digital certificate of hospitalization or an acceptance letter from an educational institution is provided. In this way a legal construct can be created and enforced without the need of a code of law or a state apparatus to enforce the law.

\subsection{Ethereum}

Ethereum~\cite{wood2018ethereum} is a platform for for deploying and executing smart contracts. Ethereum has a virtual machine (EVM) with a Turing-complete instruction set and a key-value store which forms a global singleton state. Smart contracts can be executed by broadcasting signed messages called transactions to a network of nodes. Transactions and the code they execute are processed in order by a global network of mining nodes who run the EVM and process transactions they receive. Transactions are stored in blocks which form a blockchain and are considered immutable after some point in time. In addition to executing existing smart contracts, transactions can also deploy new smart contracts or transfer a cryptocurrency called \emph{ether} from one account to another. Even though the EVM is Turing-complete, each smart contract can only perform a maximum amount of instructions decided collectively by miners and measured in a unit of account called \emph{gas}. Altogether, this forms a replicated byzantine fault-tolerant key-value store with an integrated currency with a general scripting language, open to anyone.

\subsubsection{Transactions}
Transactions are the basic units of communication in the Ethereum system. Miners validate each transaction before they include it to a block where the transaction's actions cause a state transition in the global state. Such a state transition may represent cryptographic secure ownership of titles, funds, tokens and more, depending on the transaction itself and the participants involved in it. Transactions always contain an address which identifies an \emph{account}, and may contain an optional payload of data which is the arguments to a function in a smart contract, and can also optionally transfer the cryptocurrency \emph{ether}. 

A special kind of transaction is the one that transfers ether from one account to another. It's different from other transactions in that it does not need the EVM to be processed, as it simply updates ether balances. Another special transaction is the contract creation transaction. This transaction includes a payload of bytecode which defines a new smart contract, and if successfully executed, such a transaction will permanently store the contract with a newly created associated account on the blockchain.

\subsubsection{Accounts}
Accounts are agents in the Ethereum network. All transactions must be initiated by an account, and each account has a non-negative balance of the cryptocurrency ether. There are two types of accounts: contract accounts (CA) and externally owned accounts (EOA). A contract account is a deployed smart contract with its associated bytecode. A CA can receive and send ether and invoke other smart contracts, and its behaviour will depend entirely on its code. An EOA is addressed and represented by the public key of an asymmetric key pair. An EOA can receive and send ether and create transactions, and all transactions it makes must be signed with the private key of the account. 

\subsubsection{Ether}
Ether is a cryptocurrency integrated into Ethereum. New ether is created in each new block and similarly to the block rewards in Bitcoin, it is distributed to miners in order to incentivize honest behaviour. All ether in existence is associated with an account, and can be spent in one of two ways. For an EOA, only a valid signature from the account's private key is needed to spend the ether associated with the account. CA can also send ether, but the spending conditions can be arbitrarily programmed in the smart contract's code, which allows for a huge variety of spending policies. Ether is also the only currency that can be used to pay for transaction fees, which are measured in another currency internal to Ethereum called gas.

\subsubsection{Gas}
The cost of having transactions recorded on the blockchain is denominated in gas. Each computation performed in the EVM, each byte added to the global key-value store, and each transaction validation has a fixed gas price. The prices are carefully designed to reflect the effort miners consume by processing the transaction. E.g. creating a new contract results in bytecode being permanently stored on the blockchain and so has a high gas usage, while a simple bitwise operation on two word-sized operands does not require much effort and so has a low gas usage.

Due to the impossibility for miners to accurately estimate the effort needed to process a transaction by only inspecting it, each transaction includes an amount of gas $start\_gas$ it's willing to spend. When a miner processes the transaction, each instruction performed will subtract some gas from this amount. If $start\_gas$ is not enough to pay for an instruction during processing, the transaction is reverted and its state transition is not recorded. The maximum amount of gas that can be included in a single transaction is a global variable collectively set by miners. 

\subsubsection{Mining and gas price}
Gas is a unit of account for resources on the EVM and a virtual currency within Ethereum. It can only be bought, and can only be bought with ether. In addition to single transactions having a maximum gas limit, entire blocks also have a dynamic maximum gas limit collectively set by miners. The sum of gas usage of all transactions in a block cannot exceed this limit, and it sets a limit on the number of transactions that can be processed in a single block. 

In addition to the maximum amount of gas $start\_gas$ its sender is willing to spend, a transaction includes a price per gas unit $gas\_price$ denominated in ether. Enough ether to cover the maximum gas usage $start\_gas \cdot gas\_price$ is deducted from the sender's account when the transaction is being processed. If there is remaining gas when the transaction is completed, ether corresponding to the remaining gas is refunded to the sender. Ether corresponding to the gas spent is transferred to the miner of the block that contains the transaction.

The gas price is used to incentivize miners to process transactions. A higher gas price will cause miners to process a transaction quicker, while a transaction with a low gas price might never be processed. This mechanism forms a market between senders of transactions and miners where senders bid a gas price which miners might accept. 

\subsubsection{Contract development and deployment}
Smart contracts are added to Ethereum by deploying a contract's bytecode in a special transaction. A deployed contract will always have an address and also a namespace in the global key-value store called the contract state, where values can be persistently stored. All executable code in contracts exist in functions that are referenced in a hash map stored in the contract's namespace.

Contracts are typically programmed in a high level language and compiled to bytecode which is readable by the EVM. A developer environment usually includes a local blockchain or a global alternative Ethereum blockchain called a testnet where ether is not scarce, so that contracts can be tested without needing to spend real valuable ether.

\subsubsection{Decentralized applications}
Ethereum often serves the role of a secure backend for applications accessed through a frontend web interface. The frontend typically has the ability to read the Ethereum state and make transactions to specific contracts. Such a system of one or more smart contracts and a user interface is commonly called a \emph{dApp}, short for decentralized application. A dApp is in many ways similar to other applications on the web, but a dApp using Ethereum has an immutable backend with value transfer and smart contract capability included.
