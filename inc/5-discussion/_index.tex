\chapter{Discussion}
\label{chap:discussion}

% The results you have collected and the process you when through to develop the project have been presented earlier. This Chapter is used to talk about your interpretations of results or the process. It might be a discussion of the language you used. A tool that you started to use but then stopped using for some reason. It could give insight into the evolution of your process.

\section{Programming tools}
\label{sec:tools}

We were generally able to use existing tools to our advantage for development and simulation. Truffle was used to compile and manage smart contracts. We used Truffle's testing environment and smart contract abstraction to successfully run unit tests and simulations on our code. Ganache is a program that starts an Ethereum RPC server and blockchain on your local computer. This allows one to quickly deploy contracts, make transactions, mock behaviour, and measure performance without using something out of the developer's control such as the Ethereum mainnet or even a testnet.

By limiting ourselves to using the smart contract abstraction that comes with Truffle, we were not able to overcome some shortcomings when simulating and testing. Truffle's smart contract abstraction is designed to be used in web clients of dApps that interact with the Ethereum blockchain. Since each interaction with the blockchain involves an RPC, such interactions are handled with JavaScript promises â€“ a language feature that facilitates making asynchronous applications. For every transaction RPC that is made, Truffle will wait until it is confirmed in the blockchain before it performs the next RPC. This limits how we can use Truffle when simulating, as a simulation may involve thousands of transactions, many of which can be made in parallel. In our code, we have to wait for each transaction to be confirmed before the next one is made. As our simulations require some transactions to be made in specific order, such as making commitments before revealing secrets, we have to use promises in some cases. We could avoid this limitation by making all our transaction RPCs by using web3js directly, but that would involve a more complicated simulation program. This limited out simulations to use no more than 512 participants, as using more would take a long time. However, we don't think simulations with more participants would provide much more useful data.

Our smart contracts are highly dependent on timing conditions. The time limits are specified in fields that denominate block height. E.g. a match contract is initialized with three limits: \texttt{tCommit}, \texttt{tReveal}, and \texttt{tPlay}. These are essential for security in a real deployment, but testing and simulating with many time conditions can be hard. In our testing environment we run a local blockchain using Ganache. Due to the issue with Truffle discussed above, we have to enablea feature called \emph{auto mining} with Ganache, so that a new block is generated with each transaction. This is not how the blockchain would behave in a live situation, so instead of altering our smart contract code to fit into our testing environment, we chose to not use time limits in the contracts when testing and simulating. We could configure a much more complicated testing environment where we can control which transactions are mined which which block heights etc., but chose to not spend time doing it as we were nonetheless able to run useful simulations and tests. 

\section{Blockchain security}
\label{sec:discussion-security}

The common security assumptions, attack vectors, and threat models of the underlying blockchain can be essential to understand and consider when deploying applications on top of the blockchain. Blockchain security, however, is a complex and not well understood topic. Researchers and practitioners in the space have identified various attack scenarios and concerns related to the security of a blockchain. We have discussed some of these, such as selfish mining, censorship, and block reorganization. We consider these issues important to discuss when developing an application on top of a blockchain, but since we lack real data on what happens during such an attack, as it has not happened on a major blockchain, discussing it is somewhat speculative.

Our analysis on the security of our implementation is based on uncertain assumptions and speculative attack scenarios. While something like censorship of transactions by miners certainly is possible, there is no research indicating that it is common or even in miners' interest to do so. On the other hand, blockchain platforms for smart contracts is a relatively new phenomenon, so it may well be a latent threat that will be a concern in the future. While we think that discussion on theoretical attacks is useful, we admit that the results from such discussion cannot give a concrete results that are applicable in all cases. However, when designing protocols that handle large amounts of money, a prudent approach should be taken as it's better to fail on the side of being too cautious rather than too reckless. With that in mind, our analysis on potential attacks is indeed useful. 

\section{Experimentation}
\label{sec:experimentation}

Experimentation within a real setting is something we were not able to do in this thesis. The plan was to only make a proof-of-concept implementation, but the lack of experience from a real deployment makes it difficult to answer whether Ethereum is a good platform for a distributed lottery. While some properties of the blockchain and applications built on top of it can be analyzed by merely using theory and assumptions, the live version of a blockchain like Ethereum is a complex system with many stakeholders and participants, many of whom are opportunistic or right out adversarial. One infamous example of something unexpected going wrong is the DAO and reentrancy bug exploit which resulted in a hardfork of Ethereum \cite{dhillon_dao_2017}. 

Not only is a dApp likely to face unexpected issues when deployed on a live network, but users of the dApp might have various expectations and mental models that can make a theoretically sound app not usable by its intended users. There are to date few actively used dApps on any smart contract platform, and this might be because of a failure to communicate the platform's advantages to the broader audience. Our lottery scheme is an interactive one where users are required to be online and send transactions over a period of time, and possibly enact countermeasures to attacks by adversaries. This is much more complicated than traditional online gambling sites where one typically performs one transaction and is then automatically able to withdraw the potential earnings. 
