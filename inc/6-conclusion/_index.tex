\chapter{Conclusion}
\label{chap:conclusion}

%This is where you provide an overview of the thesis now that it is finished. What are the critical
%things that can be learnt from the thesis for the reader.

The work of this thesis has been to implement a distributed lottery in Ethereum and analyze its properties and viability by gathering data and discussing security. We found that the lottery specified in \cite{miller_zero-collateral_2017} can easily be implemented in smart contracts on Ethereum. We found that transaction costs can be reduced by 36\% by splitting code into two separate match contracts, and that additional savings can probably be made by deduplicating code. Our implementation is possible to deploy on the Ethereum platform by using scripts and the Truffle framework.

Simulations of setting up and playing the lottery were executed on a local Ethereum blockchain to get insight into gas usage and whether our proof-of-concept implementation worked as expected. We found that the implementation does work as expected on a local blockchain, but attempts to deploy it on a global blockchain were not made. Gas usage was dominated by the smart contract deployment transactions needed to set up the lottery, which is all paid by the lottery organizer. From this fact we assume that the lottery is viable only if the lottery organizer can take a fee of the total price which at least covers the expense from setting it up. Based on the transaction costs, we found a way to estimate a minimum ticket price for as a function of gas price and organizer fee.

Taking the current transaction throughput of the Ethereum blockchain into account, we found a limit to how many participants a lottery of this type is able to handle if it is to finish within a reasonable time period. This limit can be expressed as a linear function of the duration of the lottery, the number of transactions in each block, and the ratio of total transactions on Ethereum are addressed to the lottery. By setting the time limit to a couple of days and assuming that 10\% of all transactions are related to the lottery, we found the limit to be in the order or 100000s of participants or $2^{17}$.

The security of the lottery was discussed in the context of several known attack vectors for blockchain applications and web applications. We found that censorship of transactions from a powerful collusion of miners is likely to be the most concerning. Due to the interactivity and time limits of the lottery protocol, we found that if miners successfully block transactions from one account for each round of the tournament, they have the power to select an arbitrary participant to win the entire lottery.
We discussed mitigating this issue, but were unable to find a satisfactory solution other than not playing the lottery if there is a powerful miner collusion. 

\section{Future work}
\label{sec:future-work}

We have identified several directions for further research on implementing lotteries on smart contact platforms.

\subsection{Minimizing transaction costs}

We were able to reduce gas usage by 36\% by splitting up the match contract to two separate contracts. As we mentioned earlier, it should be able to reduce gas usage even further by deduplicating code by using patterns such as library contracts and proxy contracts. As of our implementation, the organizer has to take a risk when setting up the lottery, as there is a chance the lottery will fail to start by not enough participants joining. By reducing transaction costs, this risk will also be lower.

\subsection{Minimizing interactivity}

The lottery implemented in this thesis requires participants to interact by sending transactions several times. Other blockchain lottery schemes such those described in \cite{andrychowicz_secure_2014} and \cite{bentov_how_2014} require less interaction, but do need a high deposit from all players. In our discussion on security we identified a vulnerability in attacks from miners censoring transactions. We also found that with the current transaction throughput in Ethereum, our lottery will need a very long time to finish if it scales to hundred of thousands of participants. 

It could be possible to come up with a design that both require few interactions and do not need high deposits from participants to avoid halting. Since security is a high priority requirement when handling large amounts of money, such a design would be an important contribution.


\subsection{Off-chain negotiation}

Even though the smart contracts in our lottery must have the capability of enforcing the protocol, they don't necessarily need to process all the transactions as we laid out. In order to reduce gas usage and number of interactions, matches can be negotiated between opponents off-chain. E.g. when both players have made their commitments, they can reveal their secrets over another communication channel. By seeing ones opponent's secret, one knows what the outcome of the match will be if both players were to reveal the secret on the blockchain. Instead, only the winner can reveal their secret while the loser forfeits by not making the reveal transaction.

Even though gas usage in the match contracts isn't that high, reducing it would nonetheless reduce overall transaction costs and make the lottery more viable. It would also be interesting to explore if hierarchical deterministic secrets (HDS) could be used to avoid making a commitments for each match. HDS is a scheme where a private key can generate child private keys and public keys can generate child public keys. Since the algorithm used is deterministic, the generated secrets can possibly be verified at a later stage.

\subsection{Formal analysis of security}

While we have discussed security issues in this thesis, we believe an even more rigorous analysis is possible. As the blockchain space matures, more research and experience is likely to appear in the coming years. This can be used to arrive at better estimates on what assumptions and conditions that are needed to make our lottery secure. Perhaps most importantly is more knowledge on the topic of censorship of transactions. Both models that allow us to find out under what conditions censorship is likely, and tactics to avoid censorship would be interesting.
