\section{Analysis}
\label{sec:analysis}

\subsection{Consequences of interactivity}

Based on the implementation choices of the lottery and the above results and discussion, it is possible to get an insight into important properties and trade-offs of the lottery. The lottery is interactive in that participants have to make several transactions in order to complete it successfully. The interactivity is a trade-off made in this design, as opposed to that of \cite{andrychowicz_secure_2014,bentov_how_2014}, where fewer transactions are necessary, but an upfront deposit is needed from all participants. We found that in our design, this has consequences for the scalability for several reasons. One is that the amount of transactions needed to play the lottery will be so high that it will start to congest the entire Ethereum network. Another reason is that the transaction costs put a lower bound on the minimum viable ticket price. As we operate with a maximum lottery prize for security reasons, this means that lotteries with higher ticket prices will have less capacity for participants.

What is gained by the interactivity of the scheme is that the lottery will complete as long as just one player follows the rules. Deposits are not needed as it seems a player has nothing to gain by not following the rules. A collusion of participants will not be able to predict the outcome of the randomness other than the outcome of the matches between players in the collusion. Due to secrets being committed to and not revealed until both players of a match have finalized their commitments, a collusion will not have any advantage over a single honest player.

We found that it is the cost of setting up the lottery by deploying contracts that is the most significant transaction cost. Since this cost directly influences the minimum viable ticket price, reducing the transaction cost of setting up the lottery would make the lottery capable of having more participants. It is likely that reducing the transaction cost can be done by using different design patterns in the smart contracts. Simply optimizing the length of the variables may also save some transaction costs. The current implementation only uses \texttt{uint256} types for numbers, but most of the numbers will never be so big that they need 256 bits to represent them. However, reducing variable length by itself won't save gas, as the EVM operate with a 32-byte (256 bits) word size. Gas could be saved by packing variables of lesser length into structs of 32 bytes, but we leave this optimization to future work.

The number of transactions needed to play the lottery has consequences both for the scalability of the lottery and the total transaction cost. This number can be reduced by playing the digital coin tosses \emph{off-chain}. Off-chain means that some part of a protocol is handled between the players over another communication channel than directly on the blockchain. Consider the digital coin toss after the commitments are made. As the outcome at that point is determined if both players reveal their secrets, it's not actually necessary to do that on the blockchain. The players could simply reveal their secrets to each other in private, and then one player would not have to make an actual transaction, as the losing party would not gain anything but still pay a transaction fee. If only the winner makes a reveal transaction, they will win regardless of what the loser does. Doing this requires no change in the smart contracts from what they are in the current implementation. 

It is possible that this idea of negotiating the matches off chain could be taken even further by using hierarchical deterministic secrets (HDS) \cite{wuille_bitcoin_2012}. The idea is that participants make a single commitment to a public key at the beginning of the tournament. In each match of level $i$, players derive a private key of index $i$ from the committed public key. This private key will serve as the secret in a normal digital coin toss protocol. The way HDS work is that a parent asymmetric key pair $(SK_p, PK_p)$ can generate deterministic key child key pairs with specific indices. By knowing just the public parent key, one can generate child public keys $\{PK_0, ..., PK_i\}$, and by knowing the private parent key, one can generate child private keys $\{SK_0, ..., SK_i\}$ which correspond to public keys with the same index. This means that a single public key can serve as a series of commitments by using its child public keys. The secrets will be verifiable as it is possible to verify that a private key corresponds to a public key if one knows both. Using this idea, a lottery could be negotiated off-chain once all players have made their commitments. Since it must be necessary to enforce the rules in case participants do not engage in the off-chain negotiation, all the contracts in the tournament would still have to exist, but would not necessarily be used. If commitments are made during the purchasing phase, the spike in transaction demand when playing the first matches could be drastically be reduced, hence increasing the scalability of the lottery.

\subsection{Tournament without a full binary tree}

The design of the lottery uses a tournament that is required to be a full binary tree and to be set up before players join. This limits the amounts of players in the lottery to those that is a power of two. While this limitation might make the lottery impractical, it makes it easier to reason about its properties in theory. If one were to allow for more flexible amounts of participants by allowing a non-full binary tree in the tournament, one would have to make sure that players would still have the same probability of winning. For instance, if one handles a tournament with $2^L+1$ players by having one player in a separate subtree, that player would advance to the final match without playing a single match before that. Should that player then be eligible for a smaller prize, or pay a higher ticket price?

Another possible solution is to have some matches consisting of three players instead of just two. Unfortunately, due to the time limits, this can give an advantage to two players in the same match colluding. In a match with three players, each player would ideally have a $\frac{1}{3}$ probability of winning, so that in a match with two colluding players, they would have a $\frac{2}{3}$ probability of winning. But if the secret of the non-colluding party Alice is revealed first, the colluding parties Colin and Lucy have three options. (i) Only Colin reveals, (ii) only Lucy reveals, and (iii) both reveal. Assuming each player who reveal has an equal probability of winning and that their secrets are uniformly random, the first two options each have a $\frac{1}{2}$ probability of either Colin or Lucy winning, while in the third options there's a $\frac{2}{3}$ chance of either winning. The slim probability that Alice wins in all the three options is just $\frac{1}{2 \cdot 2 \cdot 3}=\frac{1}{12}$, making the either Carol or Lucy win in 11 of 12 cases.

It is possible that there is a design in which a tournament with any amount of participants can be played fairly, but it would involve some considerable design changes from our lottery that is beyond the scope of this thesis.

\subsection{Mitigating a censorship attack}

A possible vulnerability in censorship of transactions was discovered. Even though the risk of a censorship attack is unknown, if we assume the possibility of a miner or collusion of miners with a majority hashing power, it would at some size of the lottery prize be in their economic interest to launch such an attack. A censorship attack is possible because of the time limits of matches, because a player unable to make transactions will lose. The time limits are however necessary to prevent a single participant halting the entire process. 

A possible way of mitigating a censorship attack is to annul the result of the tournament if the winner won a certain fraction of their matches by forfeiture. This could possibly do some collateral damage in that an honest winner could risk being suspected of cheating. It could also make the off-chain negotiation mentioned earlier in this section impractical. 

However, increasing censorship resistance is a too broad topic to be in the scope of this thesis. We operate with the common assumption that a blockchain system such as Ethereum is censorship resistant to a certain degree, and encourage lottery organizers and participants to judge the risk by the size of the lottery prize.
